# Проверка минимального размера ордера для SELL

## Проблема

При попытке продать слишком маленькое количество криптовалюты OKX возвращает ошибку:
```
"Parameter sz error" (Code: 51000)
```

Это происходит, когда количество меньше минимального размера ордера для данной торговой пары.

## Решение

Добавлена проверка минимального размера перед отправкой SELL ордера в двух местах:

1. **Обычный SELL** (по сигналу стратегии RSI+EMA)
2. **SELL по Stop-Loss / Take-Profit**

## Минимальные размеры

Для популярных пар на OKX установлены следующие минимумы:

| Пара | Минимальное количество |
|------|------------------------|
| BTCUSDT | 0.00001 BTC |
| ETHUSDT | 0.001 ETH |
| SOLUSDT | 0.01 SOL |
| BNBUSDT | 0.001 BNB |

Эти значения хранятся в методе `PositionManager::passesMinSell()`.

## Поведение

Если количество для продажи меньше минимума:

- ✅ SELL ордер **не отправляется** на биржу
- ✅ В Telegram отправляется уведомление: **"СДЕЛКА ПРОПУЩЕНА (TRADE SKIPPED)"** с причиной **"Количество слишком мало"**
- ✅ В логах выводится предупреждение с указанием минимального размера
- ✅ Позиция остаётся открытой (можно продать позже, когда накопится больше)

## Пример

**До исправления:**
```
Trade #55: SELL 0.00005764 BTC → FAILED (Parameter sz error)
Trade #57: SELL 0.00005764 BTC → FAILED (Parameter sz error)
Trade #58: SELL 0.00005764 BTC → FAILED (Parameter sz error)
Trade #59: SELL 0.00005764 BTC → FAILED (Parameter sz error)
```

**После исправления:**
```
⚠️ СДЕЛКА ПРОПУЩЕНА (TRADE SKIPPED)
Действие (Action): SELL
Причина (Reason): Количество слишком мало (Quantity too small: 0.00005764 < 0.00001)
```

## Добавление новых пар

Если нужно добавить минимальный размер для новой пары, отредактируйте массив `$minQuantities` в `PositionManager::passesMinSell()`:

```php
$minQuantities = [
    'BTCUSDT' => 0.00001,
    'ETHUSDT' => 0.001,
    'SOLUSDT' => 0.01,
    'BNBUSDT' => 0.001,
    'NEWPAIR' => 0.001, // Добавьте новую пару
];
```

## Альтернатива: получение из API

В будущем можно получать минимальные размеры динамически через OKX API:
- Endpoint: `/api/v5/public/instruments?instType=SPOT`
- Поля: `minSz` (минимальный размер) и `lotSz` (шаг размера)

Пока используется статический список для популярных пар.
