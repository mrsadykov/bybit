# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –ø—Ä–∏ push

## üìã –í–∞—Ä–∏–∞–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ Git:

---

## –í–∞—Ä–∏–∞–Ω—Ç 1: Git Hooks (post-receive) ‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å bare repository

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä—è–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–µ–ø–ª–æ–µ–º

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

#### 1. –°–æ–∑–¥–∞–π—Ç–µ bare —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@89.104.70.142

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è bare —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
mkdir -p /var/repos/bybit.git
cd /var/repos/bybit.git
git clone --bare https://github.com/–≤–∞—à-username/bybit.git .

# –ò–ª–∏ –µ—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
cd /var/www/bybit
git clone --bare . /var/repos/bybit.git
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ post-receive hook:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /var/repos/bybit.git
nano .git/hooks/post-receive
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ `scripts/server-post-receive.sh` –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª.

```bash
# –°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x .git/hooks/post-receive
```

#### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ remote –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
cd /Users/iskandarsadykov/PhpstormProjects/bybit

# –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–µ—Ä –∫–∞–∫ remote
git remote add deploy root@89.104.70.142:/var/repos/bybit.git

# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
git push deploy main
```

#### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –û–±—ã—á–Ω—ã–π push –≤ GitHub
git push origin main

# –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –ø—Ä–æ–µ–∫—Ç)
git push deploy main
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- ‚úÖ –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push
- ‚úÖ –ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ç–∫–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π bare —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pull —á–µ—Ä–µ–∑ Cron ‚≠ê –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –ï—Å–ª–∏ —É –≤–∞—Å –æ–±—ã—á–Ω—ã–π Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–µ bare)
- –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ GitHub/GitLab
- –ï—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5-10 –º–∏–Ω—É—Ç

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

#### 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@89.104.70.142
cd /var/www/bybit
mkdir -p scripts

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ scripts/server-auto-pull.sh –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
```

#### 2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
chmod +x /var/www/bybit/scripts/server-auto-pull.sh
```

#### 3. –î–æ–±–∞–≤—å—Ç–µ –≤ cron (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç):

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
*/5 * * * * /var/www/bybit/scripts/server-auto-pull.sh >/dev/null 2>&1
```

#### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ - –ø—Ä–æ—Å—Ç–æ push –≤ Git
git push origin main

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç bare —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º Git —Ö–æ—Å—Ç–∏–Ω–≥–æ–º (GitHub, GitLab, Bitbucket)

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù–µ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 5 –º–∏–Ω—É—Ç)
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç

---

## –í–∞—Ä–∏–∞–Ω—Ç 3: GitHub/GitLab Webhooks ‚≠ê –õ—É—á—à–∏–π –¥–ª—è production

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ GitHub/GitLab
- –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π
- –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–ª–æ–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞:

#### 1. –°–æ–∑–¥–∞–π—Ç–µ endpoint –¥–ª—è webhook:

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤ Laravel:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
php artisan make:controller WebhookController
```

–î–æ–±–∞–≤—å—Ç–µ –≤ `app/Http/Controllers/WebhookController.php`:

```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use Symfony\Component\Process\Process;

class WebhookController extends Controller
{
    public function handleGitHub(Request $request)
    {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–∞ (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ GITHUB_WEBHOOK_SECRET –≤ .env)
        $secret = config('services.github.webhook_secret');
        $signature = $request->header('X-Hub-Signature-256');
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
        // ...
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏—è
        $event = $request->header('X-GitHub-Event');
        
        if ($event === 'push') {
            $payload = $request->all();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ç–∫–∏
            if ($payload['ref'] === 'refs/heads/main' || $payload['ref'] === 'refs/heads/master') {
                Log::info('GitHub webhook triggered', ['event' => $event]);
                
                // –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è
                $process = Process::fromShellCommandline(
                    '/var/www/bybit/scripts/server-auto-pull.sh',
                    '/var/www/bybit'
                );
                $process->run();
                
                return response()->json(['status' => 'success']);
            }
        }
        
        return response()->json(['status' => 'ignored']);
    }
}
```

#### 2. –î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç:

```php
// routes/web.php
Route::post('/webhook/github', [WebhookController::class, 'handleGitHub'])
    ->middleware('throttle:60,1'); // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
```

#### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ GitHub:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Webhooks ‚Üí Add webhook
2. Payload URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/webhook/github`
3. Content type: `application/json`
4. Secret: (—Å–æ–∑–¥–∞–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π —Å–µ–∫—Ä–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env` –∫–∞–∫ `GITHUB_WEBHOOK_SECRET`)
5. Events: –≤—ã–±–µ—Ä–∏—Ç–µ "Just the push event"
6. Active: ‚úì

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å—å

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS
- ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è –Ω–∞—á–∞–ª–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–í–∞—Ä–∏–∞–Ω—Ç 2 (Cron)** - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π.

**–î–ª—è production:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–í–∞—Ä–∏–∞–Ω—Ç 3 (Webhooks)** - —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π.

---

## üìù –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –í–∞—Ä–∏–∞–Ω—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|-----------|----------|--------------|--------------|
| Git Hooks | –°—Ä–µ–¥–Ω—è—è | ‚ö°‚ö°‚ö° –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ | ‚úÖ –í—ã—Å–æ–∫–∞—è | –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö |
| Cron | ‚≠ê –ù–∏–∑–∫–∞—è | ‚è±Ô∏è 5-10 –º–∏–Ω | ‚úÖ –í—ã—Å–æ–∫–∞—è | **–î–ª—è –Ω–∞—á–∞–ª–∞** |
| Webhooks | –í—ã—Å–æ–∫–∞—è | ‚ö°‚ö°‚ö° –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ | ‚úÖ‚úÖ –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | **–î–ª—è production** |

---

## üîß –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–í–∞—Ä–∏–∞–Ω—Ç 2 - Cron)

```bash
# 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@89.104.70.142
cd /var/www/bybit

# 2. –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ scripts/server-auto-pull.sh)
nano scripts/server-auto-pull.sh
# –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ

# 3. –°–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x scripts/server-auto-pull.sh

# 4. –î–æ–±–∞–≤—å—Ç–µ –≤ cron
crontab -e
# –î–æ–±–∞–≤—å—Ç–µ: */5 * * * * /var/www/bybit/scripts/server-auto-pull.sh >/dev/null 2>&1

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f storage/logs/auto-pull.log
```

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.
