# üìä –ê–Ω–∞–ª–∏–∑ –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ETHUSDT - –ß–∞—Å—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏

**–û—Ä–¥–µ—Ä–∞:**
- 2026-01-19 13:38: BUY 0.00155300 ETH @ $3,218.56
- 2026-01-19 13:39: SELL 0.00010000 ETH @ $3,218.83
- 2026-01-19 13:44: BUY 0.00155400 ETH @ $3,216.10
- 2026-01-19 13:44: SELL 0.00010000 ETH @ $3,217.30

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ùå SELL –æ—Ä–¥–µ—Ä–∞ –ø—Ä–æ–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ **0.0001 ETH**, –Ω–æ BUY –ø–æ–∫—É–ø–∞—é—Ç **~0.00155 ETH**
- ‚ùå –ü–æ–∑–∏—Ü–∏–∏ **–Ω–µ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é** ‚Üí PnL –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "-")
- ‚úÖ –≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –ø–æ–∑–∏—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º–∏, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–¥–∞–Ω–æ –≤—Å–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- PnL –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–µ—Ç—Å—è
- –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è ETH –≤—Ä—É—á–Ω—É—é: `php artisan trade:sell ETHUSDT 0 --all`

---

### 2. BTCUSDT - SELL –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ BUY

**–û—Ä–¥–µ—Ä–∞:**
- 2026-01-14 13:51: BUY 0.00008551 BTC @ $93,555.90
- 2026-01-14 13:51: SELL 0.00010674 BTC @ $93,514.10
- PnL: **+0.00442217 USDT** ‚úÖ

- 2026-01-17 17:33: BUY 0.00005240 BTC @ $95,408.00
- 2026-01-17 17:35: SELL 0.00005235 BTC @ $0.00 **FAILED** ‚ùå
- 2026-01-17 17:53: BUY 0.00005242 BTC @ $95,368.50
- 2026-01-17 17:53: SELL 0.00010000 BTC @ $95,368.40
- PnL: **-0.09230559 USDT** –∏ **-0.09433493 USDT** ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:**
- ‚ö†Ô∏è SELL 0.00010674 BTC –∑–∞–∫—Ä—ã–≤–∞–µ—Ç BUY 0.00008551 BTC (–ø—Ä–æ–¥–∞–Ω–æ –±–æ–ª—å—à–µ)
- ‚ö†Ô∏è SELL 0.00010000 BTC –∑–∞–∫—Ä—ã–≤–∞–µ—Ç BUY 0.00005242 BTC (–ø—Ä–æ–¥–∞–Ω–æ –±–æ–ª—å—à–µ)
- ‚ö†Ô∏è –û–¥–∏–Ω SELL –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ BUY –ø–æ–∑–∏—Ü–∏–π (FIFO)

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –õ–æ–≥–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ - —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏
- ‚úÖ SELL –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ BUY –ø–æ–∑–∏—Ü–∏—è–º (FIFO)
- ‚úÖ PnL —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –í `RecoverTradesCommand`:

1. **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ order_id:**
   - –ë—ã–ª–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞
   - –°—Ç–∞–ª–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ –ø–æ –≤—Å–µ–π —Ç–∞–±–ª–∏—Ü–µ `trades`

2. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂:**
   - –ë—ã–ª–æ: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `totalSold >= buy->quantity`
   - –°—Ç–∞–ª–æ: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç SELL –ø–æ BUY –ø–æ–∑–∏—Ü–∏—è–º (FIFO), –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ

3. **–ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö BUY –æ–¥–Ω–∏–º SELL:**
   - –ë—ã–ª–æ: –æ–¥–∏–Ω SELL —Å–≤—è–∑—ã–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–∏–º BUY
   - –°—Ç–∞–ª–æ: –æ–¥–∏–Ω SELL –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ BUY –ø–æ–∑–∏—Ü–∏–π

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è ETHUSDT:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–¥–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è ETH –≤—Ä—É—á–Ω—É—é**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
php artisan balance:check ETH --exchange=okx

# –ü—Ä–æ–¥–∞—Ç—å –≤–µ—Å—å ETH
php artisan trade:sell ETHUSDT 0 --all
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–¥–∞–∂–∏**
- –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–∞—Å—Ç –ø—Ä–∏ —Å–∏–≥–Ω–∞–ª–µ SELL
- –ò–ª–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ Stop-Loss / Take-Profit

### –î–ª—è BTCUSDT:

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤:**
```bash
php artisan tinker
>>> \App\Models\Trade::where('symbol', 'BTCUSDT')->with('parent')->get()->each(function($t) {
    if ($t->side === 'SELL') {
        echo "SELL #{$t->id}: qty={$t->quantity}, parent_id={$t->parent_id}, closed_at=" . ($t->parent->closed_at ?? 'null') . "\n";
    }
});
>>> exit
```

**–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å–≤—è–∑–∏:**
```bash
php artisan trades:recover --symbol=BTCUSDT
```

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –æ—Ä–¥–µ—Ä–∞:
```bash
php artisan tinker
>>> \App\Models\Trade::orderBy('created_at', 'desc')->get()->each(function($t) {
    echo sprintf("%s | %s | %s | qty=%s | price=$%s | status=%s | pnl=%s\n",
        $t->created_at->format('Y-m-d H:i'),
        $t->side,
        $t->symbol,
        $t->quantity,
        $t->price,
        $t->status,
        $t->realized_pnl ?? '-'
    );
});
>>> exit
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏:
```bash
php artisan tinker
>>> \App\Models\Trade::where('side', 'BUY')
    ->where('status', 'FILLED')
    ->whereNull('closed_at')
    ->get()
    ->each(function($t) {
        echo "Bot #{$t->trading_bot_id} | {$t->symbol} | qty={$t->quantity} | price=${$t->price}\n";
    });
>>> exit
```

### –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ —Å–≤—è–∑–∏:
```bash
php artisan trades:recover
```

---

## ‚úÖ –ò—Ç–æ–≥

1. **ETHUSDT:** –ü–æ–∑–∏—Ü–∏–∏ —á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, PnL –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏
2. **BTCUSDT:** –õ–æ–≥–∏–∫–∞ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, PnL –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ö–æ–º–∞–Ω–¥–∞ `trades:recover` —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `php artisan trades:recover` –µ—â–µ —Ä–∞–∑ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å–≤—è–∑–µ–π –∏ PnL.
