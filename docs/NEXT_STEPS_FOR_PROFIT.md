# Состояние ботов после изменений и что ещё сделать для прибыли

## Текущее состояние (trading_bots после применённых настроек)

По дампу `trading_bots (4).sql`:

| Бот   | Символ   | RSI buy/sell | Position | SL   | TP   | EMA  |
|-------|----------|--------------|----------|------|------|------|
| 1     | BTCUSDT  | 38 / 62      | 10 USDT  | 3%   | 6%   | 10   |
| 2     | ETHUSDT  | 38 / 62      | 5 USDT   | 3%   | 6%   | 10   |
| 3     | SOLUSDT  | 40 / 60      | 10 USDT  | 6%   | 12%  | 15   |
| 4     | BNBUSDT  | 38 / 62      | 5 USDT   | 5%   | 10%  | 10   |

Пороги RSI соответствуют результатам оптимизации на длинном периоде (38/62 для BTC, ETH, BNB и 40/60 для SOL). Дальнейшие шаги — ниже.

---

## Что ещё можно сделать для прибыли (и снижения убытков)

Гарантированной прибыли бэктест не показывает: на последних 500–1500 свечах стратегия даёт минус при любых порогах. Ниже — реалистичные шаги, чтобы **улучшить шансы** и **ограничить просадки**.

### 1. Не ослаблять риск-настройки

- Оставить включёнными (если уже есть в `.env`):
  - `TRADING_POSITION_SIZE_MULTIPLIER` (при желании &lt; 1)
  - `TRADING_PAUSE_NEW_OPENS_DAILY_LOSS_USDT`
  - `TRADING_CONSERVATIVE_RSI` или текущие RSI из таблицы выше
- Не увеличивать размер позиции, пока стратегия на истории не станет стабильно менее убыточной или прибыльной.

### 2. Фильтры тренда/объёма — по одному и с допуском

- С двумя фильтрами разом на 1000 свечах было **0 сделок** — в проде так не включать.
- Включить **один** фильтр и при необходимости ослабить:
  - **Только тренд:**  
    `TRADING_TREND_FILTER_ENABLED=true`,  
    `TRADING_TREND_FILTER_TOLERANCE_PERCENT=0.5` (разрешить вход до 0.5% ниже длинной EMA).
  - **Только объём:**  
    `TRADING_VOLUME_FILTER_ENABLED=true`,  
    `TRADING_VOLUME_FILTER_MIN_RATIO=0.8` (вход при объёме ≥ 80% от среднего).
- После изменений перезапустить бэктест и смотреть, что сделок не ноль и результат не хуже.

### 3. Уменьшить просадку по худшим парам

- По истории больше всего минуса дают SOL и местами BNB. Варианты:
  - временно **отключить** один из ботов (is_active=0) по худшей паре;
  - или уменьшить ему `position_size` / использовать `TRADING_POSITION_SIZE_MULTIPLIER` в `.env`.

### 4. Эксперимент с таймфреймом 4h (по желанию)

- На 4h при оптимизации у части пар был выше win rate при том же минусе. Можно:
  - создать **отдельного** бота на 4h по одной паре (например ETH или BNB) с теми же RSI/EMA/SL/TP и сравнивать через 1–2 недели с 1h.

### 5. Регулярный пересмотр параметров

- Раз в 2–4 недели:
  - `php artisan strategy:optimize-all --period=1500`
  - при необходимости применить новые «наименее плохие» RSI через админку или `strategy:apply-optimize`;
  - при включённых фильтрах — проверять, что сделок не 0.

### 6. Использовать оптимизированные RSI по споту

- В `.env` поставить **TRADING_CONSERVATIVE_RSI=false**, чтобы пороги 38/62 и 45/55 из БД (и из `strategy:apply-optimize`) реально применялись, а не подменялись на 35/65. После смены: `php artisan config:clear`.

### 7. Фьючерсы и боты за BTC

- Периодически гонять бэктест по всем типам:  
  `php artisan strategy:backtest-all-bots --period=1500`  
  и смотреть, какие символы/типы дают меньше минуса.
- Фьючерсы: сначала держать в **dry_run=1**; после 1–2 недель стабильной симуляции при желании включить реал с небольшим `position_size_usdt` и лимитами `max_daily_loss_usdt` / `max_losing_streak`.

### 8. Множитель размера позиции

- В конфиге **position_size_multiplier** (например в `.env` / `config/trading.php`) — при уверенности в результатах можно осторожно поднять с 0.5 до 0.7–1.0. Не увеличивать резко; лучше после нескольких недель стабильной работы.

### 9. Фильтр MACD (по желанию)

- Включить «Фильтр MACD» у части спот-ботов в дашборде. Сначала сравнить на бэктесте с `use_macd_filter=1` и без — смотреть число сделок и PnL. Если не обнуляет сделки и не ухудшает результат — оставить на 1–2 парах и мониторить.

### 10. Идеи на будущее (доработки кода)

- **Частичное закрытие по TP** — на первом уровне TP закрывать часть позиции, остальное держать под трейлинг или второй TP.
- **Временной фильтр** — не открывать сделки в первые/последние минуты свечи или в часы низкой ликвидности.
- **Разные SL/TP по символу** — уже есть в таблице; при следующей оптимизации можно перебирать и SL/TP (если добавить это в команду оптимизации).

---

## Итог

- Текущий дамп **trading_bots (4).sql** уже отражает применённые изменения (RSI 38/62 и 40/60 для SOL).
- Для «прибыли» в текущих условиях важно: не ослаблять риск, при желании аккуратно включить **один** фильтр с допуском, при необходимости сократить риск по худшим парам и периодически перезапускать оптимизацию и бэктест.
