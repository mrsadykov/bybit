# Рекомендации по параметрам бэктестинга и торговых ботов

## Проблема: `total_trades: 0`

Если бэктестинг показывает `total_trades: 0`, это означает, что условия стратегии слишком строгие.

### Текущие условия стратегии:
- **BUY**: RSI < 30 && цена > EMA
- **SELL**: RSI > 70 && цена < EMA

Эти условия встречаются очень редко, особенно на таймфрейме 1h.

---

## Рекомендуемые параметры

### Вариант 1: Более мягкие пороги RSI (рекомендуется)

**Для всех ботов:**
- **RSI Buy Threshold**: 40 (вместо 30)
- **RSI Sell Threshold**: 60 (вместо 70)

**Почему:**
- RSI < 30 встречается редко (только при сильном перепроданном рынке)
- RSI > 70 встречается редко (только при сильном перекупленном рынке)
- Пороги 40/60 дают больше торговых возможностей, сохраняя логику стратегии

**Как применить:**
```bash
# Бэктестинг с новыми порогами
php artisan strategy:backtest-all --period=500 --exchange=okx \
  --rsi-buy-threshold=40 --rsi-sell-threshold=60
```

---

### Вариант 2: Еще более мягкие пороги (для агрессивной торговли)

**Для всех ботов:**
- **RSI Buy Threshold**: 45
- **RSI Sell Threshold**: 55

**Почему:**
- Еще больше торговых возможностей
- Подходит для волатильных рынков
- Больше сделок = больше комиссий, но больше возможностей для прибыли

---

### Вариант 3: Разные пороги для разных пар

**BTCUSDT, ETHUSDT (менее волатильные):**
- RSI Buy: 35
- RSI Sell: 65

**SOLUSDT, BNBUSDT (более волатильные):**
- RSI Buy: 40
- RSI Sell: 60

---

## Рекомендации по другим параметрам

### RSI Period (период RSI)
- **Текущее значение**: 17
- **Рекомендация**: Оставить 17 (хороший баланс между чувствительностью и стабильностью)
- **Альтернативы**: 14 (стандарт), 21 (менее чувствительный)

### EMA Period (период EMA)
- **Текущее значение**: 10 (для BTC, ETH, BNB), 15 (для SOL)
- **Рекомендация**: Оставить как есть
- **Альтернативы**: 20 (менее чувствительный), 50 (долгосрочный тренд)

### Stop-Loss / Take-Profit
- **Текущие значения**: 3-6% SL, 6-12% TP
- **Рекомендация**: Оставить как есть (хорошие значения для защиты капитала)

---

## Как обновить параметры в ботах

### Вариант 1: Через SQL (быстро)

```sql
-- Обновить все боты: использовать более мягкие пороги RSI
-- Примечание: нужно добавить поля rsi_buy_threshold и rsi_sell_threshold в таблицу trading_bots
-- Или использовать значения по умолчанию в коде стратегии
```

### Вариант 2: Обновить стратегию в коде

Обновить `app/Trading/Strategies/RsiEmaStrategy.php`:

```php
// Изменить пороги по умолчанию
if ($rsi < 40 && $currentPrice > $ema) {  // было 30
    return 'BUY';
}

if ($rsi > 60 && $currentPrice < $ema) {  // было 70
    return 'SELL';
}
```

---

## Следующие шаги

1. **Запустить бэктестинг с новыми порогами:**
   ```bash
   php artisan strategy:backtest-all --period=500 --exchange=okx \
     --rsi-buy-threshold=40 --rsi-sell-threshold=60
   ```

2. **Проанализировать результаты:**
   - Проверить количество сделок (должно быть > 0)
   - Проверить Win Rate (должен быть > 50%)
   - Проверить доходность (Return %)

3. **Оптимизировать параметры:**
   - Попробовать разные комбинации порогов
   - Протестировать на разных таймфреймах
   - Выбрать лучшие параметры для каждой пары

4. **Применить к реальным ботам:**
   - Обновить стратегию в коде
   - Или добавить поля в БД для настройки порогов

---

## Примеры команд для тестирования

```bash
# Тест с порогами 40/60
php artisan strategy:backtest BTCUSDT --timeframe=1h --exchange=okx \
  --period=500 --rsi-period=17 --ema-period=10 \
  --rsi-buy-threshold=40 --rsi-sell-threshold=60 \
  --position-size=5 --stop-loss=3 --take-profit=6 --json

# Тест с порогами 35/65 (более консервативно)
php artisan strategy:backtest BTCUSDT --timeframe=1h --exchange=okx \
  --period=500 --rsi-period=17 --ema-period=10 \
  --rsi-buy-threshold=35 --rsi-sell-threshold=65 \
  --position-size=5 --stop-loss=3 --take-profit=6 --json

# Тест с порогами 45/55 (более агрессивно)
php artisan strategy:backtest BTCUSDT --timeframe=1h --exchange=okx \
  --period=500 --rsi-period=17 --ema-period=10 \
  --rsi-buy-threshold=45 --rsi-sell-threshold=55 \
  --position-size=5 --stop-loss=3 --take-profit=6 --json
```

---

## Важные замечания

1. **Больше сделок ≠ лучше:**
   - Больше сделок = больше комиссий
   - Нужен баланс между количеством сделок и качеством сигналов

2. **Тестируйте на разных периодах:**
   - Короткие периоды (100-200 свечей) - быстрые результаты
   - Длинные периоды (500-1000 свечей) - более надежные результаты

3. **Учитывайте волатильность:**
   - Волатильные пары (SOL) могут требовать более мягких порогов
   - Стабильные пары (BTC) могут работать с более строгими порогами

4. **Backtesting ≠ реальная торговля:**
   - Бэктестинг показывает исторические результаты
   - Реальная торговля может отличаться из-за проскальзывания, задержек и т.д.
