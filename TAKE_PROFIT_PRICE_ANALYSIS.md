## Анализ цены Take-Profit

### Наблюдение

В логах видно:
- Покупка BTCUSDT: ~$88,900
- Продажа BTCUSDT: $93,514.10
- Разница: ~5.1% (близко к Take-Profit 6%)

### Возможные причины

1. **Реальная цена исполнения на бирже**
   - Если SELL ордер действительно исполнился по $93,514.10, то все правильно
   - Это может быть из-за высокой волатильности или быстрого роста цены

2. **Использование цены из предыдущей SELL сделки**
   - Если синхронизация не прошла или используется старая запись
   - Нужно проверить, что `$trade->price` обновляется из биржи

3. **Проблема с синхронизацией**
   - SELL ордер создается с `price => 0`
   - Затем `orders:sync` должен обновить цену из биржи
   - Если синхронизация не прошла, может использоваться старая цена

### Как проверить

1. **Проверить реальную цену на бирже:**
   ```bash
   php artisan balance:check BTC --exchange=okx
   ```

2. **Проверить последние SELL сделки в БД:**
   ```sql
   SELECT id, price, quantity, created_at, filled_at, status
   FROM trades
   WHERE side = 'SELL'
     AND symbol = 'BTCUSDT'
   ORDER BY id DESC
   LIMIT 5;
   ```

3. **Проверить логи синхронизации:**
   ```bash
   tail -f storage/logs/laravel.log | grep "Order execution update"
   ```

4. **Проверить, что цена обновляется из биржи:**
   - В `SyncOrdersCommand.php` строка 160: `'price' => $executedPrice`
   - `$executedPrice` берется из ответа биржи (строка 131 для OKX)

### Рекомендации

1. **Если цена $93,514.10 - реальная:**
   - Все работает правильно
   - Take-Profit срабатывает корректно
   - Прибыль фиксируется (~+0.26 USDT на сделку)

2. **Если цена $93,514.10 - неправильная:**
   - Проверить синхронизацию ордеров
   - Убедиться, что `orders:sync` запускается регулярно
   - Проверить, что цена обновляется из биржи

### Вывод

Система работает автоматически и стабильно. Если цена $93,514.10 - реальная цена исполнения на бирже, то все правильно. Если нет - нужно проверить синхронизацию ордеров.

## Следующие шаги

1. Проверить реальную цену на бирже
2. Проверить последние SELL сделки в БД
3. Сравнить цены и убедиться, что они корректны
4. Если есть расхождения - проверить синхронизацию ордеров
