# Разница между strategy:backtest-all и strategy:backtest-all-bots

## Две команды

| Команда | Описание |
|--------|----------|
| **strategy:backtest-all** | Бэктест только **спот-ботов**. Использует настройки из БД (RSI, EMA, SL/TP) **и** из конфига: **фильтр тренда** и **фильтр объёма** (если в `.env` включены `TRADING_TREND_FILTER_ENABLED` / `TRADING_VOLUME_FILTER_ENABLED`). |
| **strategy:backtest-all-bots** | Бэктест **спот + фьючерсы + btc-quote**. Для спота передаёт только параметры бота из БД, **без** глобальных фильтров тренда и объёма из конфига. |

## Почему при period=1500 разный результат по споту

- **strategy:backtest-all** при включённом в `.env` **фильтре тренда** добавляет условие: BUY только если цена выше длинной EMA (по умолчанию 50). На участке в 1000 свечей (лимит API) цена может ни разу не выполнить это условие → **0 сделок**.
- **strategy:backtest-all-bots** для спота **не** передаёт `--trend-filter` и `--volume-filter`, поэтому бэктест идёт только по RSI+EMA → появляются сделки (7, 8, 3, 4 и отрицательный PnL).

Итог: расхождение ожидаемое. **strategy:backtest-all** повторяет логику, близкую к живой торговле с текущим конфигом (с фильтрами). **strategy:backtest-all-bots** даёт «чистый» RSI+EMA по споту плюс фьючерсы и btc-quote.

## Ограничение по количеству свечей

В `BacktestStrategyCommand` запрос к API ограничен: `limit = min(period + запас, 1000)`. При `--period=1500` фактически используется **не более 1000 свечей**. Чтобы реально тестировать 1500 свечей, нужно либо увеличить лимит в коде (если API биржи позволяет), либо считать, что period=1500 для спота упирается в 1000.

## Что использовать

- **Сводка по всем типам ботов (спот + фьючерсы + btc-quote):** `php artisan strategy:backtest-all-bots --period=1500`
- **Спот в режиме «как в проде» (с фильтрами из .env):** `php artisan strategy:backtest-all --period=1500`. Если нужны сделки в бэктесте при текущем конфиге — проверь, что в `.env` отключены `TRADING_TREND_FILTER_ENABLED` и `TRADING_VOLUME_FILTER_ENABLED`, либо прими, что при включённом фильтре тренда 0 сделок на части истории нормально.
