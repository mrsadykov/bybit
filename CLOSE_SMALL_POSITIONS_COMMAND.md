# üßπ –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–æ–∑–∏—Ü–∏–π (< 1 USDT)

## üí° –ò–¥–µ—è: **–û–¢–õ–ò–ß–ù–ê–Ø!**

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:**
   - –£–¥–∞–ª—è–µ—Ç "–º—É—Å–æ—Ä–Ω—ã–µ" –ø–æ–∑–∏—Ü–∏–∏
   - –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª
   - –£–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

2. **–≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ –∫–æ–º–∏—Å—Å–∏—è—Ö:**
   - –ú–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ–≤—ã–≥–æ–¥–Ω—ã (–∫–æ–º–∏—Å—Å–∏–∏ —Å—ä–µ–¥–∞—é—Ç –ø—Ä–∏–±—ã–ª—å)
   - –õ—É—á—à–µ –∑–∞–∫—Ä—ã—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–ø–∏—Ç–∞–ª —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ

3. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:**
   - –ú–∞–ª–µ–Ω—å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –º–æ–≥—É—Ç –º–µ—à–∞—Ç—å –±–æ—Ç—É –ø–æ–∫—É–ø–∞—Ç—å
   - –ó–∞–∫—Ä—ã—Ç–∏–µ –≤ –ë–î —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É `canBuy() = false`

---

## üéØ –ß—Ç–æ –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥–∞:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–∫—Ä—ã—Ç—å –≤ –ë–î (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)
- –ù–∞–π—Ç–∏ –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ BUY –ø–æ–∑–∏—Ü–∏–∏
- –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏—Ö —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USDT (quantity √ó —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞)
- –ï—Å–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å < 1 USDT ‚Üí –∑–∞–∫—Ä—ã—Ç—å –≤ –ë–î (`closed_at = now()`)
- **–ù–ï –ø—Ä–æ–¥–∞–≤–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ** (—Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ —Å—É–º–º—ã)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–¥–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ + –∑–∞–∫—Ä—ã—Ç—å –≤ –ë–î
- –ù–∞–π—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏ < 1 USDT
- –ü—Ä–æ–¥–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
- –ó–∞–∫—Ä—ã—Ç—å –≤ –ë–î
- **–†–∏—Å–∫:** –∫–æ–º–∏—Å—Å–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —Å—É–º–º—ã –ø–æ–∑–∏—Ü–∏–∏

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

### 1. **–ü–æ—Ä–æ–≥:**
   - **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 USDT**
   - **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: --threshold=0.5** (–¥–ª—è –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏)
   - **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: --threshold=2** (–¥–ª—è –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏)

### 2. **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:**
   - **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—å –≤ –ë–î** (–±–µ–∑ –ø—Ä–æ–¥–∞–∂–∏)
   - **–û–ø—Ü–∏—è: --sell** (–ø—Ä–æ–¥–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º)
   - **–û–ø—Ü–∏—è: --dry-run** (–ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

### 3. **–§–∏–ª—å—Ç—Ä—ã:**
   - **--bot=ID** (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞)
   - **--symbol=SOLUSDT** (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞—Ä—ã)
   - **--all** (–≤—Å–µ –±–æ—Ç—ã)

---

## üîß –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

### –ö–æ–º–∞–Ω–¥–∞: `positions:close-small`

```bash
php artisan positions:close-small
php artisan positions:close-small --threshold=0.5
php artisan positions:close-small --bot=2
php artisan positions:close-small --symbol=SOLUSDT
php artisan positions:close-small --sell  # –ü—Ä–æ–¥–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ
php artisan positions:close-small --dry-run  # –¢–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å
```

### –õ–æ–≥–∏–∫–∞:

1. **–ù–∞–π—Ç–∏ –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ BUY –ø–æ–∑–∏—Ü–∏–∏:**
   ```php
   $openBuys = Trade::where('side', 'BUY')
       ->where('status', 'FILLED')
       ->whereNull('closed_at')
       ->with('bot')
       ->get();
   ```

2. **–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USDT:**
   ```php
   foreach ($openBuys as $trade) {
       $currentPrice = $exchangeService->getPrice($trade->symbol);
       $valueUsdt = $trade->quantity * $currentPrice;
       
       if ($valueUsdt < $threshold) {
           // –ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é
       }
   }
   ```

3. **–ó–∞–∫—Ä—ã—Ç—å –≤ –ë–î:**
   ```php
   $trade->update([
       'closed_at' => now(),
       'realized_pnl' => 0  // –∏–ª–∏ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å SELL
   ]);
   ```

4. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ:**
   ```php
   if ($sellOnExchange) {
       $exchangeService->placeMarketSell($trade->symbol, $trade->quantity);
   }
   ```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

### 1. **–ö–æ–º–∏—Å—Å–∏–∏:**
   - –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –ø–æ–∑–∏—Ü–∏–∏ < 1 USDT –∫–æ–º–∏—Å—Å–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —Å—É–º–º—ã
   - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –≤ –ë–î, –±–µ–∑ –ø—Ä–æ–¥–∞–∂–∏

### 2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞:**
   - OKX: –º–∏–Ω–∏–º—É–º 0.0001 BTC, 0.001 ETH, 0.01 SOL
   - –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º—É–º–∞ ‚Üí —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—å –≤ –ë–î

### 3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram —Å–ø–∏—Å–æ–∫ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
   - –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—â—É—é —Å—É–º–º—É –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞

---

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
üîç –ü–æ–∏—Å–∫ –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–æ–∑–∏—Ü–∏–π (< 1.00 USDT)...

–ù–∞–π–¥–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π: 2

----------------------------------------
Bot #2 | ETHUSDT
  –ü–æ–∑–∏—Ü–∏—è #123: 0.00000089 ETH @ $3,218.56
  –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.0029 USDT
  ‚úÖ –ó–∞–∫—Ä—ã—Ç–æ –≤ –ë–î

----------------------------------------
Bot #3 | SOLUSDT
  –ü–æ–∑–∏—Ü–∏—è #124: 0.0000006 SOL @ $133.72
  –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.0001 USDT
  ‚úÖ –ó–∞–∫—Ä—ã—Ç–æ –≤ –ë–î

----------------------------------------
–ò—Ç–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–æ: 2 –ø–æ–∑–∏—Ü–∏–∏
–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –∫–∞–ø–∏—Ç–∞–ª–∞: $0.0030 USDT
```

---

## üéØ –ò—Ç–æ–≥:

**–ö–æ–º–∞–Ω–¥–∞ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–∞!** –û–Ω–∞ –ø–æ–º–æ–∂–µ—Ç:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å `canBuy() = false`
- ‚úÖ –û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –∫–∞–ø–∏—Ç–∞–ª –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫
- ‚úÖ –£–ø—Ä–æ—â–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º

**–†–µ–∫–æ–º–µ–Ω–¥—É—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å –æ–ø—Ü–∏—è–º–∏:**
- `--threshold=1.0` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `--dry-run` (–ø–æ–∫–∞–∑–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- `--sell` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –Ω–∞ –±–∏—Ä–∂–µ)
- `--bot=ID` (—Ñ–∏–ª—å—Ç—Ä –ø–æ –±–æ—Ç—É)
- `--symbol=SYMBOL` (—Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–∞—Ä–µ)

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ cron –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏:
```bash
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ < 1 USDT
0 3 * * * cd /var/www/trading-bot && php artisan positions:close-small >> /dev/null 2>&1
```

–ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ Laravel Scheduler:
```php
// routes/console.php
Schedule::command('positions:close-small')
    ->dailyAt('03:00')
    ->withoutOverlapping();
```
